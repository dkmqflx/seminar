- ci cd란 메인 레포에 새롭게 추가되는 기능들을 ci 서버에서 자동으로 빌드하고 테스트해서 지속적으로 배포하는 것을 말한다.

- 이처럼 개발 프로세스의 핵심은 자동화

- 버전 관리 시스템으로 과정 많이 쓰이는 깃과 그걸 배포할 수 있는 깃허브가 있는데

- 여기서 자동화를 이용하면 예전에는 Jenkins, Buildkite, circle ci와 같은 외부 툴들을 사용했다

- 하지만 이제는 깃허브 액션을 통해서 별도의 외부 툴 필요없이 자동화 프로세스를 만들어 볼 수 있다.

- 여기서는 깃허브 액션을 통해서 어떻게 자동화 ci cd를 구축할 수 있는지,

- 커밋을 할 때마다 내가 원하는 테스트를 수행하고 또는 PR을 메인 브런치로 머지 하기 전에 항상 정해진 테스트를 수행하는 데모도 보여준다

<br/>

## 깃허브 Actions 정리

- 깃허브 액션은 다섯가지 개념만 알고 있으면 된다.

- Events, Workflows, Jobs, Actions, Runners

<br/>

### Event

<img src='./images/제발 깃허브 액션 모르는 개발자 없게해 주세요/01.png'>

- 깃허브 액션은 특정한 이벤트가 발생했을 때 내가 뭐 나는 이를 자동으로 수행할 수 있도록 만들어 주는 툴이기 때문에 어떤 일이 발생했는지를 지정할 수 있는 이벤트를 잘 이해해야 한다

- 이벤트는 깃허브에서 발생할 수 있는 대부분의 이벤트를 지정할 수 있는데

- 내 PR을 메인 브랜치로 머지 할 때 어떤 테스트를 수행해야 한다면 그 이벤트를 지정해 줄 수도 있고

- 커밋을 깃허브에 푸쉬 하거나 또는 새로운 이슈를 누군가가 만드는 경우 그 때 수행해야 되는 일이 있다면 그런 이벤트들도 다 지정할 수 있다

<br/>

### Workflows

<img src='./images/제발 깃허브 액션 모르는 개발자 없게해 주세요/02.png'>

- 그래서 특정한 이벤트가 발생했을 때 내가 어떤 일을 수행하고 싶냐를 명시할 수 있는 것이 바로 워크플로우

- 위 사진에서는 push라는 이벤트가 발생하면 이렇게 Workflows에 지정된 것들이 수행이 된다.

- Workflows는 한마디로 요리책 같은 건데

- 내가 파스타를 먹고 싶다는 이벤트가 발생 한다면 파스타를 만들 수 있는 레시피 책을 보는 것처럼

- 워크플로우 이용해 볼 수 있다.

<br/>

### Jobs

<img src='./images/제발 깃허브 액션 모르는 개발자 없게해 주세요/03.png'>

- 워크플로우 안에는 Job이 있다.

- 하나 또는 다수의 잡을 가지고 있을 수 있는데 이 하나의 잡은 무언가를 한다.

- 여기서는 유닛테스트를 동작하는 잡이 있고 그리고 E2E 테스트를 진행하는 잡이 있다.

- 기본적으로는 이 잡이 수행되는 동안 다른 잡도 수행되고 병렬적으로 동시다발적으로 실행이 된다

- 만약 이 잡이 끝난 다음에 다른 잡을 수행 해야 된다면 순차적으로 진행될 수 있도록 만들 수도 있다

- 그리고 각각의 잡이 어떤 순서대로 실행이 되어야 되는지 스텝을 하나씩 명시해 줄 수 있는데

- 쉘 스크립트를 사용해서 어떤 스텝을 해야 되는지를 명시해 줄 수 있고

- 이렇게 npm install, npm run e2e-test 같은 명령어도 수행할 수 있다

<br/>

### Actions

<img src='./images/제발 깃허브 액션 모르는 개발자 없게해 주세요/04.png'>

- 그리고 깃허브 액션에서 아주 유용한 바로 액션을 사용할 수도 있다.

- 깃허브 액션에는 우리가 재 사용할 수 있는 공개적으로 오픈된 액션들이 많이 있다.

- 그래서 우리가 흔하게 사용할 수 있는 다양한 명령들이 이렇게 액션 으로 정해 되어져 있다.

- action checkout이라는 액션은 레포를 체크하는 액션으로, 레포를 체크한 다음 우리가 원하는 npm test라는 명령어를 수행할 수 도 있고

- action checkout 다음, action setup node를 사용하면 자동적으로 노드 환경을 셋업할 수 있는 코드들이 실행이 된다.

- 깃허브 액션에는 우리가 npm 에서 라이브러리를 가져다 쓰는 것처럼 이미 잘 만들어진, 우리가 필요한 대부분 액션들이 여기에다 공개적으로 정해 되어져 있기 때문에 그냥 갖다 쓰면 된다.

<br/>
 
- 최종적으로 정리를 한번 더 해보자면, 특정한 이벤트가 발생했을 때 우리가 실행하고 싶은, 자동화 하고 싶은 스크립트를 워크플로우 안에 작성해 줄 수 있고

- 워크플로우 안에는 하나의 잡이나 또는 다수의 잡을 정의할 수 있다.

- 그래서 각각의 잡 안에는 어떤 순서대로 일들이 수행 되어야 하는지 우리가 스크립트 형태로 작성할 수 있고

- 또는 깃허브에서 제공해 주는 유용한 액션을 그냥 가져다가 쓰면 된다.

<br/>

### Runners

<img src='./images/제발 깃허브 액션 모르는 개발자 없게해 주세요/05.png'>

- 그리고 기본적으로 각각의 잡들은 병렬적으로 실행이 된다고 했는데, 이 잡을 실행하는 것이 바로 러너

- 이 러너를 vm 머신 이라고도 볼 수 있고 또는 도커 컨테이너 라고 보면 된다.

- 그래서 각각의 잡은 개별적인 독립적인 각각의 러너 라는 컨테이너에서 시행 된다고 보면 된다.

<br/>

- 깃허브 액션 을 사용하기 위해서는 우리 프로젝트 경로 안에 `./github/workflows/` 라는 폴더를 만들어야 한다

- 그리고 여기에 우리가 원하는 yml 파일을 만들면 된다. (`./github/workflows/workflow.yml`)

- 여기서 workflow라는 부분의 이름은 우리가 원하는 대로 어떤 워크플로우인지에 따라서 이름을 잘 정해주면 된다.

- 워크플로우 디렉토리 안에만 있으면 된다.

- 파일은 아래와 같다

<img src='./images/제발 깃허브 액션 모르는 개발자 없게해 주세요/06.png'>

- 여기에 워크플로우인지 이름을 명시할 수 있고 (`name`)

- 그리고 어떤 이벤트가 발생했을 때 1월 푸어 가 실행되면 되는지 이벤트 를 명시할 수 있다 (`on: [push]`)

  - 커밋이 푸시 될 때마다 워크플로우를 실행한다는 뜻

- 그래서 푸시란 이벤트가 발생하면 잡들이 실행이 되어야 하는데 (`jobs`)

- 어떤 잡인지 이렇게 하나로 만들어진 걸 볼 수 있고(`check-bats-version: ....`)

- 첫 줄 에는 어떤 일을 수행하는지 잡의 이름이 나와 있고(`check-bats-version`)

- 그리고 언어를 사용할 때 어떤 언어를 사용할건지 즉, 어떤 vm 머신 을 사용 할 건지를 명시할 수 있다 (`runs-on: ubuntu-latest`)

  - 그래서 이 작업을 수행할 때는 우분투에 최신버전의 vm 을 사용 해줬다고 명시할 수 있다

- 그리고 stpes에서 어떤 순서대로 잡을 실행 해야 되는지 순서가 나와있다. (`steps: `)

- 그래서 첫번째로는 액션을 사용할 건데 checkout 액션을 사용할 것 (`uses: actions/checkout@v3`)

  - 즉, 깃허브 액션에서 제공해주는 checkout이라는 액션을 사용할 것

- 그리고 또 액션을 사용할 건데 노드를 셋업 해주는는 액션을 사용할 것 (`uses: actions/setup-node@v3`)

- 그리고 with라는 문법을 통해서 노드 버전을 명시하고 있는 걸 확인해 볼 수 있다 (`with: node-version: '14'`)

- 이렇게 레포지토리를 checkout 하고, 노드를 setup 한 다음에

- 원하는 명령어 쉘 스크립트를 여기에 작성한 걸 확인해 볼 수 있다 (`run: ...`)

---

## Reference

- [제발 깃허브 액션🔥 모르는 개발자 없게해 주세요 🙏](https://www.youtube.com/watch?v=iLqGzEkusIw&t=1s)

- [Understanding GitHub Actions](https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#workflows)
